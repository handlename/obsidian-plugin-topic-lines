# タスク定義

本文書は、REQUIREMENTS.md（FR-010〜FR-012）およびDESIGN.mdに基づく実装タスクを定義する。

---

## フェーズ1: 設定インフラ

設定データの型定義と永続化の基盤を整備する。

- [x] T-1.1: 設定インターフェースの拡張
  - 目的: 新しい設定項目（frontmatterKeys, showFileName）を型定義に追加する
  - 詳細: `src/settings.ts` に `frontmatterKeys: string[]` と `showFileName: boolean` を追加し、デフォルト値を設定する
  - 完了条件: `TopicLineSettings` インターフェースに新しいフィールドが定義され、`DEFAULT_SETTINGS` にデフォルト値が設定されている

- [x] T-1.2: 設定の読み込み・保存ロジック調整
  - 目的: 既存データとの互換性を保ちつつ、設定データを正しく永続化する
  - 詳細: `src/main.ts` の `loadSettings()` と `saveSettings()` を調整し、既存の `TopicData` と `settings` が共存できるようにする。既存データに `settings` がない場合はデフォルト値を適用する
  - 完了条件: 既存データがある環境でプラグインを起動しても設定が正しく読み込まれ、新しい設定を保存してもトピックデータが失われない

---

## フェーズ2: 設定画面

ユーザーが設定を変更できるUIを実装する。

- [x] T-2.1: 設定タブの新規作成
  - 目的: Obsidianの設定画面にプラグイン設定タブを追加する
  - 詳細: `src/settings-tab.ts` を新規作成し、`PluginSettingTab` を継承した `TopicLineSettingTab` クラスを実装する
  - 完了条件: `TopicLineSettingTab` クラスが作成され、空の `display()` メソッドが実装されている

- [x] T-2.2: Frontmatterキー設定UIの実装
  - 目的: 表示するfrontmatterキーを設定できるUIを提供する
  - 詳細: テキストエリアまたはテキスト入力を使用し、カンマ区切りまたは改行区切りでキーを入力できるようにする。入力値は即座に設定に反映・保存する
  - 完了条件: 設定画面でfrontmatterキーを入力でき、値が `plugin.settings.frontmatterKeys` に配列として保存される

- [x] T-2.3: ファイル名表示トグルの実装
  - 目的: ファイル名表示のON/OFFを切り替えられるUIを提供する
  - 詳細: トグルスイッチを使用し、変更時に即座に設定に反映・保存する
  - 完了条件: 設定画面でトグルを操作でき、値が `plugin.settings.showFileName` に保存される

- [x] T-2.4: 設定タブの登録
  - 目的: プラグイン起動時に設定タブをObsidianに登録する
  - 詳細: `src/main.ts` の `onload()` で `this.addSettingTab()` を呼び出す
  - 完了条件: Obsidianの設定画面に「Topic Lines」タブが表示される

---

## フェーズ3: Frontmatter機能

frontmatterから情報を取得し、トピックに表示する機能を実装する。

- [x] T-3.1: Frontmatter解析ユーティリティの作成
  - 目的: ファイルのfrontmatterから指定キーの値を取得する関数を提供する
  - 詳細: `src/frontmatter.ts` を新規作成し、`getFrontmatterValues()` と `formatFrontmatterValue()` 関数を実装する。Obsidianの `metadataCache` を使用してfrontmatterを取得する
  - 完了条件: 指定したキーの値を取得でき、配列値はカンマ区切り文字列に変換される

- [x] T-3.2: 設定文字列パーサーの実装
  - 目的: 設定画面で入力された文字列をキー配列に変換する
  - 詳細: `src/frontmatter.ts` に `parseFrontmatterKeys()` 関数を実装し、カンマ区切りと改行区切りの両方に対応する
  - 完了条件: `"status, tags\npriority"` のような入力が `["status", "tags", "priority"]` に変換される

- [x] T-3.3: トピックビューへのFrontmatter表示追加
  - 目的: トピック一覧にfrontmatter情報を表示する
  - 詳細: `src/topic-view.ts` の `renderTopicItem()` メソッドを拡張し、設定されたキーのfrontmatter値を `.topic-frontmatter` 要素として表示する
  - 完了条件: 設定でキーを指定すると、各トピックに該当するfrontmatter値が「キー: 値」形式で表示される

- [x] T-3.4: Frontmatter表示用スタイルの追加
  - 目的: frontmatter情報を視覚的に区別できるスタイルを提供する
  - 詳細: `styles.css` に `.topic-frontmatter`、`.topic-frontmatter-item`、`.topic-frontmatter-key`、`.topic-frontmatter-value` のスタイルを追加する
  - 完了条件: frontmatter情報がタグ風の見た目で表示され、ライト/ダークテーマ両方で適切に表示される

---

## フェーズ4: ファイル名表示切り替え

設定に基づいてファイル名の表示・非表示を制御する。

- [x] T-4.1: ファイル名表示の条件付き実装
  - 目的: 設定に基づいてファイル名表示を制御する
  - 詳細: `src/topic-view.ts` の `renderTopicItem()` で、`plugin.settings.showFileName` が `true` の場合のみファイル名を表示するように変更する
  - 完了条件: `showFileName` が `false`（デフォルト）のときファイル名が非表示、`true` のとき表示される

- [x] T-4.2: 設定変更時の即時反映
  - 目的: 設定変更がサイドバービューに即座に反映されるようにする
  - 詳細: 設定変更時に `TopicView.render()` が呼び出されるよう、設定変更通知の仕組みを実装する
  - 完了条件: 設定画面でトグルを変更すると、サイドバーのファイル名表示がリアルタイムで切り替わる

---

## フェーズ5: 検証・調整

実装した機能の動作確認と調整を行う。

- [ ] T-5.1: 設定画面の動作確認
  - 目的: 設定画面が正しく動作することを確認する
  - 詳細: 設定タブの表示、各設定項目の入力・保存、Obsidian再起動後の設定保持を確認する
  - 完了条件: すべての設定項目が正しく動作し、再起動後も設定が保持される

- [ ] T-5.2: Frontmatter表示の動作確認
  - 目的: frontmatter表示機能が正しく動作することを確認する
  - 詳細: 以下のケースを確認する: (1) 指定キーの値表示、(2) 存在しないキーのスキップ、(3) 配列値のカンマ区切り表示、(4) frontmatterがないファイル
  - 完了条件: すべてのケースで期待通りの動作をする

- [ ] T-5.3: ファイル名表示切り替えの動作確認
  - 目的: ファイル名表示の切り替えが正しく動作することを確認する
  - 詳細: デフォルト非表示、ON/OFF切り替え、即時反映を確認する
  - 完了条件: 設定に応じてファイル名の表示・非表示が正しく切り替わる

- [ ] T-5.4: ビルドとLintの確認
  - 目的: コードが正しくビルドでき、Lint警告がないことを確認する
  - 詳細: `npm run build` と `npm run lint` を実行し、エラーがないことを確認する
  - 完了条件: ビルド成功、Lint警告なし

---

## 依存関係

```
フェーズ1 (設定インフラ)
    │
    ├── T-1.1 → T-1.2
    │
    ▼
フェーズ2 (設定画面)
    │
    ├── T-2.1 → T-2.2 → T-2.4
    │       └── T-2.3 → T-2.4
    │
    ▼
フェーズ3 (Frontmatter機能)      フェーズ4 (ファイル名表示)
    │                                │
    ├── T-3.1 → T-3.3               └── T-4.1 → T-4.2
    ├── T-3.2 → T-3.3
    └── T-3.4
    │                                │
    └────────────┬───────────────────┘
                 │
                 ▼
          フェーズ5 (検証・調整)
```

**注記**:
- フェーズ3とフェーズ4は並行実行可能
- フェーズ5はフェーズ3・4の完了後に実行

---

## 変更履歴

| 日付 | バージョン | 変更内容 |
|---|---|---|
| 2026-01-10 | 1.0 | 初版作成 |
